default:
  image: python:3.9
  # Default runner tag
  tags:
    - inasset

variables:
  PACKAGE_NAME: 'wjs.jcom_profile'

# Not running any tests (at the moment), because they require a
# working installation of Janeway, with this django app installed.
stages:
  - test
  - build
  - deploy


include:
  - project: 'wjs/wjs-profile-project'
    ref: feature/task-20-autodeploy-packages
    file: '.gitlab-ci-pkg-build-and-upload.yml'
  - project: 'wjs/wjs-profile-project'
    ref: feature/task-20-autodeploy-packages
    file: '.gitlab-ci-pkg-deploy-to-test.yml'
  - project: 'wjs/wjs-profile-project'
    ref: feature/task-20-autodeploy-packages
    file: '.gitlab-ci-run-tests.yml'


run-tests:
  # remove me before going to master
  only:
    - feature/task-20-autodeploy-packages
  except:
    - tags

  extends:
    - .run-tests

upload-package:
  only:
    - tags

  extends:
    - .upload-package

  # might be not necessry, but best is to explicit dependencies
  needs:
    - run-tests

deploy-to-test:
  only:
    - tags

  extends:
    - .deploy-to-test

  needs:
    - upload-package
